function islemYap(e,t){if(13==t.keyCode){var a=document.getElementById("DEPARTMENT_ID").value,r=document.getElementById("LOCATION_ID").value,n=document.getElementById("ORDER_ID").value,_=document.getElementById("SEPET_ID").value,T=e.value;T=ReplaceAll(T,"||","|");var O=list_getat(T,1,"|"),E=list_getat(T,2,"|"),S=list_getat(T,3,"|"),R={UrunKodu:O,LotNo:E,Agirlik:S,SEPET_DEPARTMAN_ID:a,SEPET_LOCATION_ID:r,SEPET_ORDER_ID:n,SEPET_ID:_},o=wrk_query("SELECT * FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE LOT_NO='"+E+"'","dsn3");if(console.log(o),0==o.recordcount){var I="SELECT * FROM ( SELECT SUM(SR.STOCK_IN-SR.STOCK_OUT) AS SSSR,SR.PRODUCT_ID,SR.STOCK_ID,S.PRODUCT_NAME,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.UNIT2 FROM w3Toruntex_2023_1.STOCKS_ROW AS SR";I+=" INNER JOIN w3Toruntex.STOCKS_LOCATION AS SL ON SL.LOCATION_ID=SR.STORE_LOCATION AND SL.DEPARTMENT_ID=SR.STORE  INNER JOIN w3Toruntex_1.STOCKS AS S ON S.STOCK_ID=SR.STOCK_ID WHERE LOT_NO='"+E+"' GROUP BY SR.PRODUCT_ID,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.STOCK_ID,S.PRODUCT_NAME,SR.UNIT2 ) AS TTTS WHERE SSSR<>0";var u=wrk_query(I,"dsn2");if(0==u.recordcount)return $("#LastRead").text(R.LotNo+" - "+O+" - "+R.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-dark"),document.getElementById("LastRead").setAttribute("style","text-decoration: line-through;"),$("#BARKOD").val(""),$("#BARKOD").focus(),alert("Lot Numarası Bulunamadı !"),!1;console.log(u),R.STOCK_LOCATION_ID=u.STORE_LOCATION[0],R.STOCK_DEPARTMENT_ID=u.STORE[0],R.PRODUCT_ID=u.PRODUCT_ID[0],R.UNIT2=u.UNIT2[0],R.STOCK_ID=u.STOCK_ID[0],R.PBS_RELATION_ID=u.PBS_RELATION_ID[0],R.PRODUCT_NAME=u.PRODUCT_NAME[0];var s=R.SEPET_DEPARTMAN_ID+"-"+R.SEPET_LOCATION_ID,A=R.STOCK_DEPARTMENT_ID+"-"+R.STOCK_LOCATION_ID;R.TASIMA=s==A?0:1;var d=document.getElementByProductId(R.PRODUCT_ID);R.SATIRDA=null!=d?1:0;I="SELECT * FROM ORDER_ROW WHERE ORDER_ID="+n+" AND PRODUCT_ID="+R.PRODUCT_ID;var i=wrk_query(I,"dsn3");if(console.log(i),i.recordcount?(R.EXTRA_PRODUCT=0,R.HAVE_SIPARIS=1):(R.EXTRA_PRODUCT=1,R.HAVE_SIPARIS=0),1==R.EXTRA_PRODUCT){var l={FROM_STOCK_ID:R.STOCK_ID,FROM_LOT_NO:R.LotNo,FROM_AMOUNT:R.Agirlik,FROM_WRK_ROW_ID:R.PBS_RELATION_ID,TO_DEPARTMENT_ID:R.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:R.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:R.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:R.STOCK_LOCATION_ID,FROM_UNIT2:R.UNIT2,TO_WRK_ROW_ID:""},c=JSON.stringify(l);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+c),console.table(l)}else if(1==R.TASIMA){l={FROM_STOCK_ID:R.STOCK_ID,FROM_LOT_NO:R.LotNo,FROM_AMOUNT:R.Agirlik,FROM_WRK_ROW_ID:R.PBS_RELATION_ID,TO_DEPARTMENT_ID:R.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:R.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:R.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:R.STOCK_LOCATION_ID,FROM_UNIT2:R.UNIT2,TO_WRK_ROW_ID:i.WRK_ROW_ID[0]},c=JSON.stringify(l);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+c),console.table(l)}if(1!=R.SATIRDA){var D=SepeteEkle(R.SEPET_ID,"",R.PRODUCT_ID,R.Agirlik,1,"KG",R.UNIT2);OkumaEkle(R.Agirlik,1,R.LotNo,D,"KG",R.UNIT2),SatirEkle(R.PRODUCT_ID,R.PRODUCT_NAME,R.Agirlik,"KG",R.UNIT2)}else SatirGuncelle(R.PRODUCT_ID,R.Agirlik,R.LotNo);console.table(R);var N=document.getElementById("myAudio");N.play();var m=parseFloat(document.getElementById("AdS").innerText);m+=parseFloat(R.Agirlik),document.getElementById("AdS").innerText=m;var C=parseFloat(document.getElementById("AdK").innerText);C+=1,document.getElementById("AdK").innerText=C,$("#LastRead").text(R.LotNo+" - "+R.PRODUCT_NAME+" - "+R.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-success")}else{I="SELECT * FROM ( SELECT SUM(SR.STOCK_IN-SR.STOCK_OUT) AS SSSR,SR.PRODUCT_ID,SR.STOCK_ID,S.PRODUCT_NAME,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT FROM w3Toruntex_2023_1.STOCKS_ROW AS SR";I+=" INNER JOIN w3Toruntex.STOCKS_LOCATION AS SL ON SL.LOCATION_ID=SR.STORE_LOCATION AND SL.DEPARTMENT_ID=SR.STORE  INNER JOIN w3Toruntex_1.STOCKS AS S ON S.STOCK_ID=SR.STOCK_ID WHERE LOT_NO='"+E+"' GROUP BY SR.PRODUCT_ID,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.STOCK_ID,S.PRODUCT_NAME ) AS TTTS WHERE SSSR<>0";u=wrk_query(I,"dsn2");alert("Bu Lot Numarası Daha Önce Okutulmuş"),$("#LastRead").text(R.LotNo+" - "+u.PRODUCT_NAME[0]+" - "+R.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-danger")}$("#BARKOD").val(""),$("#BARKOD").focus()}}function OkumaEkle(e,t,a,r,n,_=""){var T="INSERT INTO SEVKIYAT_SEPET_ROW_READ_PBS (SEPET_ROW_ID,LOT_NO,AMOUNT,AMOUNT2,UNIT,UNIT2) VALUES ("+r+",'"+a+"',"+e+","+t+",'"+n;_.length>0?T=T+",'"+_+"'":T+=",NULL",T+=")";var O=GetAjaxQuery(T,"dsn3");return console.log(O),O.RECORDCOUNT>0&&O.RESULT.GENERATEDKEY}function SepeteEkle(e,t,a,r,n,_,T=""){var O="INSERT INTO  w3Toruntex_1.SEVKIYAT_SEPET_ROW_PBS (SEPET_ID,WRK_ROW_ID,PRODUCT_ID,AMOUNT,AMOUNT2,UNIT,UNIT2) VALUES ("+e+",'"+t+"',"+a+","+r+",1,'KG'";T.length>0?O+=",'"+T+"'":O+=",NULL",O+=")";var E=GetAjaxQuery(O,"dsn3");return E.RECORDCOUNT>0&&E.RESULT.GENERATEDKEY}function SatirEkle(e,t,a,r){var n=document.createElement("tr");n.setAttribute("class","bg-danger"),n.setAttribute("data-fromSiparis",0);var _=document.createElement("td");_.innerText=a+"/0",_.setAttribute("id","AMOUNT_"+e),n.appendChild(_);_=document.createElement("td");_.setAttribute("id","AMOUNT2_"+e),_.innerText="1/0",n.appendChild(_);_=document.createElement("td");_.setAttribute("id","PRODUCT_NAME_"+e),_.innerText=t,n.appendChild(_),n.setAttribute("data-product_id",e),n.setAttribute("data-SEPET_ROW_ID",r),document.getElementById("Sepetim").appendChild(n)}function SatirGuncelle(e,t,a){var r=document.getElementById("AMOUNT_"+e).innerText,n=list_getat(r,2,"/").trim(),_=list_getat(r,1,"/").trim(),T=parseFloat(_),O=document.getElementById("AMOUNT2_"+e).innerText,E=list_getat(O,2,"/").trim(),S=list_getat(O,1,"/").trim(),R=parseFloat(S),o=document.getElementByProductId(e).getAttribute("data-SEPET_ROW_ID"),I=(T+parseFloat(t)).toString()+"/"+n;document.getElementById("AMOUNT_"+e).innerText=I;var u=(R+1).toString()+"/"+E;document.getElementById("AMOUNT2_"+e).innerText=u;O=document.getElementById("AMOUNT2_"+e).innerText,E=list_getat(O,2,"/").trim(),S=list_getat(O,1,"/").trim(),R=parseFloat(S);var s=parseFloat(E),A=parseInt(document.getElementById("ROW_"+e).getAttribute("data-fromSiparis"));1==A?R>s?document.getElementById("ROW_"+e).setAttribute("class","bg-primary"):R==s&&document.getElementById("ROW_"+e).setAttribute("class","bg-success"):document.getElementById("ROW_"+e).setAttribute("class","bg-danger"),OkumaEkle(t,1,a,o)}function GetAjaxQuery(str_query,data_source,maxrows){var CompanyInfo=new Object,url="/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=query_executer&isAjax=1",myAjaxConnector=GetAjaxConnector();if(myAjaxConnector&&(data="str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows,myAjaxConnector.open("post",url+"&xmlhttp=1",!1),myAjaxConnector.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),myAjaxConnector.setRequestHeader("pragma","nocache"),myAjaxConnector.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),myAjaxConnector.setRequestHeader("X-Requested-With","XMLHttpRequest"),myAjaxConnector.send(data),4==myAjaxConnector.readyState&&200==myAjaxConnector.status))try{CompanyInfo=eval(myAjaxConnector.responseText.replace(/\u200B/g,""))[0]}catch(e){CompanyInfo=!1}return CompanyInfo}function SevkiyatKapa(e,t){var a="UPDATE w3Toruntex_1.SEVKIYAT_SEPET_PBS set IS_CLOSED=1 ^ISNULL(IS_CLOSED,0) WHERE SEPET_ID="+t,r=GetAjaxQuery(a,"dsn3");console.log(r),"1"==e.getAttribute("data-status")?(e.setAttribute("data-status","0"),e.setAttribute("class","form-control btn btn-warning"),e.innerText="Sevkiyat Açık",document.getElementById("BARKOD").removeAttribute("disabled"),$("#BARKOD").focus()):(e.setAttribute("data-status","1"),e.setAttribute("class","form-control btn btn-danger"),e.innerText="Sevkiyat Kilitli",document.getElementById("BARKOD").setAttribute("disabled","true"))}function wrk_query(str_query,data_source,maxrows){function callpage(url){if(req=!1,window.XMLHttpRequest)try{req=new XMLHttpRequest}catch(e){req=!1}else if(window.ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){req=!1}}if(req){function return_function_(){if(4==req.readyState&&200==req.status)try{eval(req.responseText.replace(/\u200B/g,"")),new_query=get_js_query}catch(e){new_query=!1}}req.open("post",url+"&xmlhttp=1",!1),req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),req.setRequestHeader("pragma","nocache"),-1==encodeURI(str_query).indexOf("+")?req.send("str_sql="+encodeURI(str_query)+"&data_source="+data_source+"&maxrows="+maxrows):req.send("str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows),return_function_()}}var new_query=new Object,req;return data_source||(data_source="dsn"),maxrows||(maxrows=0),callpage("/index.cfm?fuseaction=objects2.emptypopup_get_js_query&isAjax=1"),new_query}function SendFormData(e,t){var a=document.createElement("form");a.target="Map",a.method="POST",a.action=e;var r=document.createElement("input");r.type="hidden",r.name="data",r.value=JSON.stringify(t),a.appendChild(r),document.body.appendChild(a),map=window.open(e,"Map","status=0,title=0,height=600,width=800,scrollbars=1"),map?a.submit():alert("You must allow popups for this map to work.")}function EksiislemYap(e,t){if(13==t.keyCode){var a=e.value;a=ReplaceAll(a,"||","|");list_getat(a,1,"|");var r=list_getat(a,2,"|"),n=(list_getat(a,3,"|"),document.getElementById("SEPET_ID").value),_=wrk_query("SELECT SRR.LOT_NO,SRR.SEPET_ROW_ID,SRR.AMOUNT,SSR.PRODUCT_ID,S.PRODUCT_NAME FROM SEVKIYAT_SEPET_ROW_READ_PBS AS SRR INNER JOIN SEVKIYAT_SEPET_ROW_PBS AS  SSR ON SSR.SEPET_ROW_ID=SRR.SEPET_ROW_ID INNER JOIN STOCKS AS S ON S.PRODUCT_ID=SSR.PRODUCT_ID  WHERE SRR.LOT_NO='"+r+"' AND SSR.SEPET_ID="+n,"DSN3");if(_.recordcount>0){var T="INSERT INTO w3Toruntex_1.SEVKIYAT_SEPET_CIKAN (LOT_NO,SEPET_ROW_ID,AMOUNT,SEPET_ID,PRODUCT_ID,RECORD_EMP,RECORD_DATE) VALUES ('"+r+"',"+_.SEPET_ROW_ID[0]+","+_.AMOUNT[0]+","+n+","+_.PRODUCT_ID[0]+","+UserId+",GETDATE())",O="DELETE FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE LOT_NO='"+r+"'";GetAjaxQuery(T,"DSN3"),GetAjaxQuery(O,"DSN3"),window.location.reload()}else alert(r+" Lot Numaralı Ürün Bulunamadı")}}function IptalEt(e){var t=document.getElementById("SEPET_ID").value,a=confirm("Sevkiyat Listesindeki Tüm Okutmalar Sıfırlanacaktır Onaylıyormusunuz ?");if(a){var r="DELETE FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE SEPET_ROW_ID IN (SELECT SEPET_ROW_ID FROM SEVKIYAT_SEPET_ROW_PBS WHERE SEPET_ID="+t+")",n=GetAjaxQuery(r,"dsn3");console.log(n),alert(n.RESULT.RECORDCOUNT+"Satır Silindi ")}}$(document).ready(function(){var e=document.getElementsByTagName("link");for(let r=0;r<e.length;r++){var t=e[r],a=t.getAttribute("href");-1!=a.indexOf("gui_custom")&&t.remove()}1==SevkStatus?document.getElementById("BARKOD").setAttribute("disabled","true"):$("#BARKOD").focus(),$("#AdS").text(ToplamKg),$("#AdK").text(ToplamAdet)}),document.addEventListener("click",function(e){var t=document.getElementById("BARKOD");e.target!==t&&t.focus()}),document.getElementByProductId=function(e){var t=e.toString(),a=$("*").find("* [data-product_id='"+t+"']")[0];return a};