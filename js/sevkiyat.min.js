function islemYap(e,t){if(13==t.keyCode){var a=document.getElementById("DEPARTMENT_ID").value,n=document.getElementById("LOCATION_ID").value,_=document.getElementById("ORDER_ID").value,r=document.getElementById("SEPET_ID").value,E=e.value;E=ReplaceAll(E,"||","|");var T=list_getat(E,1,"|"),O=list_getat(E,2,"|"),S=list_getat(E,3,"|"),R={UrunKodu:T,LotNo:O,Agirlik:S,SEPET_DEPARTMAN_ID:a,SEPET_LOCATION_ID:n,SEPET_ORDER_ID:_,SEPET_ID:r},o=wrk_query("SELECT * FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE LOT_NO='"+O+"'","dsn3");if(console.log(o),0==o.recordcount){var s="SELECT * FROM ( SELECT SUM(SR.STOCK_IN-SR.STOCK_OUT) AS SSSR,SR.PRODUCT_ID,SR.STOCK_ID,S.PRODUCT_NAME,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.UNIT2 FROM "+dsn2+".STOCKS_ROW AS SR";s+=" INNER JOIN "+dsn+".STOCKS_LOCATION AS SL ON SL.LOCATION_ID=SR.STORE_LOCATION AND SL.DEPARTMENT_ID=SR.STORE  INNER JOIN "+dsn3+".STOCKS AS S ON S.STOCK_ID=SR.STOCK_ID WHERE LOT_NO='"+O+"' GROUP BY SR.PRODUCT_ID,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.STOCK_ID,S.PRODUCT_NAME,SR.UNIT2 ) AS TTTS WHERE SSSR<>0";var I=wrk_query(s,"dsn2");if(0==I.recordcount)return $("#LastRead").text(R.LotNo+" - "+T+" - "+R.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-dark"),document.getElementById("LastRead").setAttribute("style","text-decoration: line-through;"),$("#BARKOD").val(""),$("#BARKOD").focus(),alert("Lot Numarası Bulunamadı !"),!1;console.log(I),R.STOCK_LOCATION_ID=I.STORE_LOCATION[0],R.STOCK_DEPARTMENT_ID=I.STORE[0],R.PRODUCT_ID=I.PRODUCT_ID[0],R.UNIT2=I.UNIT2[0],R.STOCK_ID=I.STOCK_ID[0],R.PBS_RELATION_ID=I.PBS_RELATION_ID[0],R.PRODUCT_NAME=I.PRODUCT_NAME[0];var u=R.SEPET_DEPARTMAN_ID+"-"+R.SEPET_LOCATION_ID,d=R.STOCK_DEPARTMENT_ID+"-"+R.STOCK_LOCATION_ID;R.TASIMA=u==d?0:1;var i=document.getElementByProductId(R.PRODUCT_ID);R.SATIRDA=null!=i?1:0;s="SELECT * FROM ORDER_ROW WHERE ORDER_ID="+_+" AND PRODUCT_ID="+R.PRODUCT_ID;var A=wrk_query(s,"dsn3");if(console.log(A),A.recordcount?(R.EXTRA_PRODUCT=0,R.HAVE_SIPARIS=1):(R.EXTRA_PRODUCT=1,R.HAVE_SIPARIS=0),1==R.EXTRA_PRODUCT){var l={FROM_STOCK_ID:R.STOCK_ID,FROM_LOT_NO:R.LotNo,FROM_AMOUNT:R.Agirlik,FROM_WRK_ROW_ID:R.PBS_RELATION_ID,TO_DEPARTMENT_ID:R.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:R.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:R.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:R.STOCK_LOCATION_ID,FROM_UNIT2:R.UNIT2,TO_WRK_ROW_ID:"",SEPET_ID:R.SEPET_ID},D=JSON.stringify(l);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+D),console.table(l)}else if(1==R.TASIMA){l={FROM_STOCK_ID:R.STOCK_ID,FROM_LOT_NO:R.LotNo,FROM_AMOUNT:R.Agirlik,FROM_WRK_ROW_ID:R.PBS_RELATION_ID,TO_DEPARTMENT_ID:R.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:R.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:R.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:R.STOCK_LOCATION_ID,FROM_UNIT2:R.UNIT2,TO_WRK_ROW_ID:A.WRK_ROW_ID[0],SEPET_ID:R.SEPET_ID},D=JSON.stringify(l);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+D),console.table(l)}if(1!=R.SATIRDA){var c=SepeteEkle(R.SEPET_ID,"",R.PRODUCT_ID,R.Agirlik,1,"KG",R.UNIT2);OkumaEkle(R.Agirlik,1,R.LotNo,c,"KG",R.UNIT2),SatirEkle(R.PRODUCT_ID,R.PRODUCT_NAME,R.Agirlik,"KG",R.UNIT2)}else SatirGuncelle(R.PRODUCT_ID,R.Agirlik,R.LotNo,"KG",R.UNIT2);console.table(R);var m=document.getElementById("myAudio");m.play();var N=parseFloat(document.getElementById("AdS").innerText);N+=parseFloat(R.Agirlik),document.getElementById("AdS").innerText=N;var C=parseFloat(document.getElementById("AdK").innerText);C+=1,document.getElementById("AdK").innerText=C,$("#LastRead").text(R.LotNo+" - "+R.PRODUCT_NAME+" - "+R.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-success")}else{s="SELECT * FROM ( SELECT SUM(SR.STOCK_IN-SR.STOCK_OUT) AS SSSR,SR.PRODUCT_ID,SR.STOCK_ID,S.PRODUCT_NAME,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT FROM "+dsn2+".STOCKS_ROW AS SR";s+=" INNER JOIN "+dsn+".STOCKS_LOCATION AS SL ON SL.LOCATION_ID=SR.STORE_LOCATION AND SL.DEPARTMENT_ID=SR.STORE  INNER JOIN "+dsn3+".STOCKS AS S ON S.STOCK_ID=SR.STOCK_ID WHERE LOT_NO='"+O+"' GROUP BY SR.PRODUCT_ID,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.STOCK_ID,S.PRODUCT_NAME ) AS TTTS WHERE SSSR<>0";I=wrk_query(s,"dsn2");alert("Bu Lot Numarası Daha Önce Okutulmuş"),$("#LastRead").text(R.LotNo+" - "+I.PRODUCT_NAME[0]+" - "+R.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-danger")}$("#BARKOD").val(""),$("#BARKOD").focus()}}function OkumaEkle(e,t,a,n,_,r=""){var E="INSERT INTO SEVKIYAT_SEPET_ROW_READ_PBS (SEPET_ROW_ID,LOT_NO,AMOUNT,AMOUNT2,UNIT,UNIT2) VALUES ("+n+",'"+a+"',"+e+","+t+",'KG'";r.length>0?E=E+",'"+r+"'":E+=",NULL",E+=")";var T=GetAjaxQuery(E,"dsn3");return console.log(T),T.RECORDCOUNT>0&&T.RESULT.GENERATEDKEY}function SepeteEkle(e,t,a,n,_,r,E=""){var T="INSERT INTO  "+dsn3+".SEVKIYAT_SEPET_ROW_PBS (SEPET_ID,WRK_ROW_ID,PRODUCT_ID,AMOUNT,AMOUNT2,UNIT,UNIT2) VALUES ("+e+",'"+t+"',"+a+","+n+",1,'KG'";E.length>0?T+=",'"+E+"'":T+=",NULL",T+=")";var O=GetAjaxQuery(T,"dsn3");return O.RECORDCOUNT>0&&O.RESULT.GENERATEDKEY}function SatirEkle(e,t,a,n){var _=document.createElement("tr");_.setAttribute("class","bg-danger"),_.setAttribute("data-fromSiparis",0);var r=document.createElement("td");r.innerText=a+"/0",r.setAttribute("id","AMOUNT_"+e),_.appendChild(r);r=document.createElement("td");r.setAttribute("id","AMOUNT2_"+e),r.innerText="1/0",_.appendChild(r);r=document.createElement("td");r.setAttribute("id","PRODUCT_NAME_"+e),r.innerText=t,_.appendChild(r),_.setAttribute("data-product_id",e),_.setAttribute("data-SEPET_ROW_ID",n),document.getElementById("Sepetim").appendChild(_)}function SatirGuncelle(e,t,a,n,_){var r=document.getElementById("AMOUNT_"+e).innerText,E=list_getat(r,2,"/").trim(),T=list_getat(r,1,"/").trim(),O=parseFloat(T),S=document.getElementById("AMOUNT2_"+e).innerText,R=list_getat(S,2,"/").trim(),o=list_getat(S,1,"/").trim(),s=parseFloat(o),I=document.getElementByProductId(e).getAttribute("data-SEPET_ROW_ID"),u=(O+parseFloat(t)).toString()+"/"+E;document.getElementById("AMOUNT_"+e).innerText=u;var d=(s+1).toString()+"/"+R;document.getElementById("AMOUNT2_"+e).innerText=d;S=document.getElementById("AMOUNT2_"+e).innerText,R=list_getat(S,2,"/").trim(),o=list_getat(S,1,"/").trim(),s=parseFloat(o);var i=parseFloat(R),A=parseInt(document.getElementById("ROW_"+e).getAttribute("data-fromSiparis"));1==A?s>i?document.getElementById("ROW_"+e).setAttribute("class","bg-primary"):s==i&&document.getElementById("ROW_"+e).setAttribute("class","bg-success"):document.getElementById("ROW_"+e).setAttribute("class","bg-danger"),OkumaEkle(t,1,a,I,n,_)}function GetAjaxQuery(str_query,data_source,maxrows){var CompanyInfo=new Object,url="/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=query_executer&isAjax=1",myAjaxConnector=GetAjaxConnector();if(myAjaxConnector&&(data="str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows,myAjaxConnector.open("post",url+"&xmlhttp=1",!1),myAjaxConnector.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),myAjaxConnector.setRequestHeader("pragma","nocache"),myAjaxConnector.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),myAjaxConnector.setRequestHeader("X-Requested-With","XMLHttpRequest"),myAjaxConnector.send(data),4==myAjaxConnector.readyState&&200==myAjaxConnector.status))try{CompanyInfo=eval(myAjaxConnector.responseText.replace(/\u200B/g,""))[0]}catch(e){CompanyInfo=!1}return CompanyInfo}function SevkiyatKapa(e,t){var a="UPDATE "+dsn3+".SEVKIYAT_SEPET_PBS set IS_CLOSED=1 ^ISNULL(IS_CLOSED,0) WHERE SEPET_ID="+t,n=GetAjaxQuery(a,"dsn3");console.log(n),"1"==e.getAttribute("data-status")?(e.setAttribute("data-status","0"),e.setAttribute("class","form-control btn btn-warning"),e.innerText="Sevkiyat Açık",document.getElementById("BARKOD").removeAttribute("disabled"),$("#BARKOD").focus()):(e.setAttribute("data-status","1"),e.setAttribute("class","form-control btn btn-danger"),e.innerText="Sevkiyat Kilitli",document.getElementById("BARKOD").setAttribute("disabled","true"))}function wrk_query(str_query,data_source,maxrows){function callpage(url){if(req=!1,window.XMLHttpRequest)try{req=new XMLHttpRequest}catch(e){req=!1}else if(window.ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){req=!1}}if(req){function return_function_(){if(4==req.readyState&&200==req.status)try{eval(req.responseText.replace(/\u200B/g,"")),new_query=get_js_query}catch(e){new_query=!1}}req.open("post",url+"&xmlhttp=1",!1),req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),req.setRequestHeader("pragma","nocache"),-1==encodeURI(str_query).indexOf("+")?req.send("str_sql="+encodeURI(str_query)+"&data_source="+data_source+"&maxrows="+maxrows):req.send("str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows),return_function_()}}var new_query=new Object,req;return data_source||(data_source="dsn"),maxrows||(maxrows=0),callpage("/index.cfm?fuseaction=objects2.emptypopup_get_js_query&isAjax=1"),new_query}function SendFormData(e,t){var a=document.createElement("form");a.target="Map",a.method="POST",a.action=e;var n=document.createElement("input");n.type="hidden",n.name="data",n.value=JSON.stringify(t),a.appendChild(n),document.body.appendChild(a),map=window.open(e,"Map","status=0,title=0,height=600,width=800,scrollbars=1"),map?a.submit():alert("You must allow popups for this map to work.")}function EksiislemYap(e,t){if(13==t.keyCode){var a=e.value;a=ReplaceAll(a,"||","|");list_getat(a,1,"|");var n=list_getat(a,2,"|"),_=(list_getat(a,3,"|"),document.getElementById("SEPET_ID").value),r=wrk_query("SELECT SRR.LOT_NO,SRR.SEPET_ROW_ID,SRR.AMOUNT,SSR.PRODUCT_ID,S.PRODUCT_NAME FROM SEVKIYAT_SEPET_ROW_READ_PBS AS SRR INNER JOIN SEVKIYAT_SEPET_ROW_PBS AS  SSR ON SSR.SEPET_ROW_ID=SRR.SEPET_ROW_ID INNER JOIN STOCKS AS S ON S.PRODUCT_ID=SSR.PRODUCT_ID  WHERE SRR.LOT_NO='"+n+"' AND SSR.SEPET_ID="+_,"DSN3");if(r.recordcount>0){var E="INSERT INTO "+dsn3+".SEVKIYAT_SEPET_CIKAN (LOT_NO,SEPET_ROW_ID,AMOUNT,SEPET_ID,PRODUCT_ID,RECORD_EMP,RECORD_DATE) VALUES ('"+n+"',"+r.SEPET_ROW_ID[0]+","+r.AMOUNT[0]+","+_+","+r.PRODUCT_ID[0]+","+UserId+",GETDATE())",T="DELETE FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE LOT_NO='"+n+"'";GetAjaxQuery(E,"DSN3"),GetAjaxQuery(T,"DSN3"),window.location.reload()}else alert(n+" Lot Numaralı Ürün Bulunamadı")}}function IptalEt(e){var t=document.getElementById("SEPET_ID").value,a=confirm("Sevkiyat Listesindeki Tüm Okutmalar Sıfırlanacaktır Onaylıyormusunuz ?");if(a){var n="DELETE FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE SEPET_ROW_ID IN (SELECT SEPET_ROW_ID FROM SEVKIYAT_SEPET_ROW_PBS WHERE SEPET_ID="+t+")",_=GetAjaxQuery(n,"dsn3");console.log(_);n="DELETE FROM SEVKIYAT_SEPET_ROW_PBS WHERE SEPET_ID IN ("+t+")",_=GetAjaxQuery(n,"dsn3"),n="DELETE FROM SEVKIYAT_SEPET_PBS WHERE SEPET_ID IN ("+t+")",_=GetAjaxQuery(n,"dsn3");console.log(_),$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=fis_sil&SEPET_ID="+t),alert("Belge İptal Edilmiştir"),window.location.href="/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=22"}}$(document).ready(function(){var e=document.getElementsByTagName("link");for(let n=0;n<e.length;n++){var t=e[n],a=t.getAttribute("href");-1!=a.indexOf("gui_custom")&&t.remove()}1==SevkStatus?document.getElementById("BARKOD").setAttribute("disabled","true"):$("#BARKOD").focus(),$("#AdS").text(ToplamKg),$("#AdK").text(ToplamAdet)}),document.addEventListener("click",function(e){var t=document.getElementById("BARKOD");e.target!==t&&t.focus()}),document.getElementByProductId=function(e){var t=e.toString(),a=$("*").find("* [data-product_id='"+t+"']")[0];return a};