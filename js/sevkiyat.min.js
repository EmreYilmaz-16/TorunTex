function islemYap(el,ev){if(13==ev.keyCode){var SEPET_DEPARTMAN_ID=document.getElementById("DEPARTMENT_ID").value,SEPET_LOCATION_ID=document.getElementById("LOCATION_ID").value,SEPET_ORDER_ID=document.getElementById("ORDER_ID").value,SEPET_ID=document.getElementById("SEPET_ID").value,UrunBarkodu=el.value;UrunBarkodu=ReplaceAll(UrunBarkodu,"||","|");var UrunKodu=list_getat(UrunBarkodu,1,"|"),LotNo=list_getat(UrunBarkodu,2,"|"),Agirlik,OSX={UrunKodu:UrunKodu,LotNo:LotNo,Agirlik:list_getat(UrunBarkodu,3,"|"),SEPET_DEPARTMAN_ID:SEPET_DEPARTMAN_ID,SEPET_LOCATION_ID:SEPET_LOCATION_ID,SEPET_ORDER_ID:SEPET_ORDER_ID,SEPET_ID:SEPET_ID},Res1=wrk_query("SELECT * FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE LOT_NO='"+LotNo+"'","dsn3");if(console.log(Res1),0==Res1.recordcount){var QueryString="SELECT * FROM ( SELECT SUM(SR.STOCK_IN-SR.STOCK_OUT) AS SSSR,SR.PRODUCT_ID,SR.STOCK_ID,S.PRODUCT_NAME,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT FROM w3Toruntex_2023_1.STOCKS_ROW AS SR",Res2=wrk_query(QueryString+=" INNER JOIN w3Toruntex.STOCKS_LOCATION AS SL ON SL.LOCATION_ID=SR.STORE_LOCATION AND SL.DEPARTMENT_ID=SR.STORE  INNER JOIN w3Toruntex_1.STOCKS AS S ON S.STOCK_ID=SR.STOCK_ID WHERE LOT_NO='"+LotNo+"' GROUP BY SR.PRODUCT_ID,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.STOCK_ID,S.PRODUCT_NAME ) AS TTTS WHERE SSSR<>0","dsn2");console.log(Res2),OSX.STOCK_LOCATION_ID=Res2.STORE_LOCATION[0],OSX.STOCK_DEPARTMENT_ID=Res2.STORE[0],OSX.PRODUCT_ID=Res2.PRODUCT_ID[0],OSX.STOCK_ID=Res2.STOCK_ID[0],OSX.PBS_RELATION_ID=Res2.PBS_RELATION_ID[0];var SL_1=OSX.SEPET_DEPARTMAN_ID+"-"+OSX.SEPET_LOCATION_ID,SL_2=OSX.STOCK_DEPARTMENT_ID+"-"+OSX.STOCK_LOCATION_ID;OSX.TASIMA=SL_1==SL_2?0:1;var Satirim=document.getElementByProductId(OSX.PRODUCT_ID);OSX.SATIRDA=null!=Satirim?1:0;var QueryString,Res3=wrk_query(QueryString="SELECT * FROM ORDER_ROW WHERE ORDER_ID="+SEPET_ORDER_ID+" AND PRODUCT_ID="+OSX.PRODUCT_ID,"dsn3");if(console.log(Res3),Res3.recordcount?(OSX.EXTRA_PRODUCT=0,OSX.HAVE_SIPARIS=1):(OSX.EXTRA_PRODUCT=1,OSX.HAVE_SIPARIS=0),1==OSX.EXTRA_PRODUCT){var TasimaVeri={FROM_STOCK_ID:OSX.STOCK_ID,FROM_LOT_NO:OSX.LotNo,FROM_AMOUNT:OSX.Agirlik,FROM_WRK_ROW_ID:OSX.PBS_RELATION_ID,TO_DEPARTMENT_ID:OSX.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:OSX.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:OSX.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:OSX.STOCK_LOCATION_ID,TO_WRK_ROW_ID:""},str=JSON.stringify(TasimaVeri);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+str),console.table(TasimaVeri)}else if(1==OSX.TASIMA){var TasimaVeri={FROM_STOCK_ID:OSX.STOCK_ID,FROM_LOT_NO:OSX.LotNo,FROM_AMOUNT:OSX.Agirlik,FROM_WRK_ROW_ID:OSX.PBS_RELATION_ID,TO_DEPARTMENT_ID:OSX.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:OSX.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:OSX.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:OSX.STOCK_LOCATION_ID,TO_WRK_ROW_ID:Res3.WRK_ROW_ID[0]},str=JSON.stringify(TasimaVeri);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+str),console.table(TasimaVeri)}if(1!=OSX.SATIRDA){var GENERATEDKEY=SepeteEkle(OSX.SEPET_ID,OSX.PBS_RELATION_ID,OSX.PRODUCT_ID,OSX.Agirlik,1);OkumaEkle(OSX.Agirlik,1,OSX.LotNo,GENERATEDKEY),SatirEkle(OSX.PRODUCT_ID,OSX.PRODUCT_NAME,OSX.Agirlik)}else SatirGuncelle(OSX.PRODUCT_ID,OSX.Agirlik,OSX.LotNo);console.table(OSX)}else alert("Bu Lot Numarası Daha Önce Okutulmuş")}}function OkumaEkle(AMOUNT,AMOUNT2,LOT_NO,SEPET_ROW_ID){var str,QueryResult=GetAjaxQuery("INSERT INTO SEVKIYAT_SEPET_ROW_READ_PBS (SEPET_ROW_ID,LOT_NO,AMOUNT,AMOUNT2) VALUES ("+SEPET_ROW_ID+",'"+LOT_NO+"',"+AMOUNT+","+AMOUNT2+")","dsn3");return console.log(QueryResult),QueryResult.RECORDCOUNT>0&&QueryResult.RESULT.GENERATEDKEY}function SepeteEkle(SEPET_ID,WRK_ROW_ID,PRODUCT_ID,AMOUNT,AMOUNT2){var str,QueryResult=GetAjaxQuery("INSERT INTO  w3Toruntex_1.SEVKIYAT_SEPET_ROW_PBS (SEPET_ID,WRK_ROW_ID,PRODUCT_ID,AMOUNT,AMOUNT2) VALUES ("+SEPET_ID+",'"+WRK_ROW_ID+"',"+PRODUCT_ID+","+AMOUNT+",1) ","dsn3");return QueryResult.RECORDCOUNT>0&&QueryResult.RESULT.GENERATEDKEY}function SatirEkle(PRODUCT_ID,PRODUCT_NAME,AMOUNT,SEPET_ROW_ID){var tr=document.createElement("tr"),td,td,td;(td=document.createElement("td")).innerText=AMOUNT+"/0",tr.appendChild(td),(td=document.createElement("td")).innerText="1/0",tr.appendChild(td),(td=document.createElement("td")).innerText=PRODUCT_NAME,tr.appendChild(td),tr.setAttribute("data-product_id",PRODUCT_ID),tr.setAttribute("data-SEPET_ROW_ID",SEPET_ROW_ID),document.getElementById("Sepetim").appendChild(tr)}function SatirGuncelle(PRODUCT_ID,ARGA_AMOUNT,LotNo){var AMOUNT_=document.getElementById("AMOUNT_"+PRODUCT_ID).innerText,TOTAL_1=list_getat(AMOUNT_,2,"/").trim(),AMOUNT__=list_getat(AMOUNT_,1,"/").trim(),AMOUNT=parseFloat(AMOUNT__),AMOUNT2_=document.getElementById("AMOUNT2_"+PRODUCT_ID).innerText,TOTAL_2=list_getat(AMOUNT2_,2,"/").trim(),AMOUNT2__=list_getat(AMOUNT2_,1,"/").trim(),AMOUNT2=parseFloat(AMOUNT2__),SEPET_ROW_ID=document.getElementByProductId(PRODUCT_ID).getAttribute("data-SEPET_ROW_ID"),str_1=(AMOUNT+parseFloat(ARGA_AMOUNT)).toString()+"/"+TOTAL_1;document.getElementById("AMOUNT_"+PRODUCT_ID).innerText=str_1;var str_2=(AMOUNT2+1).toString()+"/"+TOTAL_2;document.getElementById("AMOUNT2_"+PRODUCT_ID).innerText=str_2,OkumaEkle(ARGA_AMOUNT,1,LotNo,SEPET_ROW_ID)}function GetAjaxQuery(str_query,data_source,maxrows){var CompanyInfo=new Object,url="/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=query_executer&isAjax=1",myAjaxConnector=GetAjaxConnector();if(myAjaxConnector&&(data="str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows,myAjaxConnector.open("post",url+"&xmlhttp=1",!1),myAjaxConnector.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),myAjaxConnector.setRequestHeader("pragma","nocache"),myAjaxConnector.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),myAjaxConnector.setRequestHeader("X-Requested-With","XMLHttpRequest"),myAjaxConnector.send(data),4==myAjaxConnector.readyState&&200==myAjaxConnector.status))try{CompanyInfo=eval(myAjaxConnector.responseText.replace(/\u200B/g,""))[0]}catch(e){CompanyInfo=!1}return CompanyInfo}function wrk_query(str_query,data_source,maxrows){var new_query=new Object,req;function callpage(url){if(req=!1,window.XMLHttpRequest)try{req=new XMLHttpRequest}catch(e){req=!1}else if(window.ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){req=!1}}if(req){function return_function_(){if(4==req.readyState&&200==req.status)try{eval(req.responseText.replace(/\u200B/g,"")),new_query=get_js_query}catch(e){new_query=!1}}req.open("post",url+"&xmlhttp=1",!1),req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),req.setRequestHeader("pragma","nocache"),-1==encodeURI(str_query).indexOf("+")?req.send("str_sql="+encodeURI(str_query)+"&data_source="+data_source+"&maxrows="+maxrows):req.send("str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows),return_function_()}}return data_source||(data_source="dsn"),maxrows||(maxrows=0),callpage("/index.cfm?fuseaction=objects2.emptypopup_get_js_query&isAjax=1"),new_query}function SendFormData(uri,BasketData){var mapForm=document.createElement("form");mapForm.target="Map",mapForm.method="POST",mapForm.action=uri;var mapInput=document.createElement("input");mapInput.type="hidden",mapInput.name="data",mapInput.value=JSON.stringify(BasketData),mapForm.appendChild(mapInput),document.body.appendChild(mapForm),map=window.open(uri,"Map","status=0,title=0,height=600,width=800,scrollbars=1"),map?mapForm.submit():alert("You must allow popups for this map to work.")}document.getElementByProductId=function(idb){var str=idb.toString(),el;return $("*").find("* [data-product_id='"+str+"']")[0]};