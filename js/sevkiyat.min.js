function islemYap(e,t){if(13==t.keyCode){var r=document.getElementById("DEPARTMENT_ID").value,a=document.getElementById("LOCATION_ID").value,n=document.getElementById("ORDER_ID").value,_=document.getElementById("SEPET_ID").value,T=e.value;T=ReplaceAll(T,"||","|");var O=list_getat(T,1,"|"),S=list_getat(T,2,"|"),o=list_getat(T,3,"|"),E={UrunKodu:O,LotNo:S,Agirlik:o,SEPET_DEPARTMAN_ID:r,SEPET_LOCATION_ID:a,SEPET_ORDER_ID:n,SEPET_ID:_},R=wrk_query("SELECT * FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE LOT_NO='"+S+"'","dsn3");if(console.log(R),0==R.recordcount){var u="SELECT * FROM ( SELECT SUM(SR.STOCK_IN-SR.STOCK_OUT) AS SSSR,SR.PRODUCT_ID,SR.STOCK_ID,S.PRODUCT_NAME,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT FROM w3Toruntex_2023_1.STOCKS_ROW AS SR";u+=" INNER JOIN w3Toruntex.STOCKS_LOCATION AS SL ON SL.LOCATION_ID=SR.STORE_LOCATION AND SL.DEPARTMENT_ID=SR.STORE  INNER JOIN w3Toruntex_1.STOCKS AS S ON S.STOCK_ID=SR.STOCK_ID WHERE LOT_NO='"+S+"' GROUP BY SR.PRODUCT_ID,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.STOCK_ID,S.PRODUCT_NAME ) AS TTTS WHERE SSSR<>0";var s=wrk_query(u,"dsn2");if(0==s.recordcount)return $("#LastRead").text(E.LotNo+" - "+O+" - "+E.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-dark"),document.getElementById("LastRead").setAttribute("style","text-decoration: line-through;"),$("#BARKOD").val(""),$("#BARKOD").focus(),alert("Lot Numarası Bulunamadı !"),!1;console.log(s),E.STOCK_LOCATION_ID=s.STORE_LOCATION[0],E.STOCK_DEPARTMENT_ID=s.STORE[0],E.PRODUCT_ID=s.PRODUCT_ID[0],E.STOCK_ID=s.STOCK_ID[0],E.PBS_RELATION_ID=s.PBS_RELATION_ID[0],E.PRODUCT_NAME=s.PRODUCT_NAME[0];var A=E.SEPET_DEPARTMAN_ID+"-"+E.SEPET_LOCATION_ID,I=E.STOCK_DEPARTMENT_ID+"-"+E.STOCK_LOCATION_ID;E.TASIMA=A==I?0:1;var d=document.getElementByProductId(E.PRODUCT_ID);E.SATIRDA=null!=d?1:0;u="SELECT * FROM ORDER_ROW WHERE ORDER_ID="+n+" AND PRODUCT_ID="+E.PRODUCT_ID;var i=wrk_query(u,"dsn3");if(console.log(i),i.recordcount?(E.EXTRA_PRODUCT=0,E.HAVE_SIPARIS=1):(E.EXTRA_PRODUCT=1,E.HAVE_SIPARIS=0),1==E.EXTRA_PRODUCT){var l={FROM_STOCK_ID:E.STOCK_ID,FROM_LOT_NO:E.LotNo,FROM_AMOUNT:E.Agirlik,FROM_WRK_ROW_ID:E.PBS_RELATION_ID,TO_DEPARTMENT_ID:E.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:E.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:E.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:E.STOCK_LOCATION_ID,TO_WRK_ROW_ID:""},c=JSON.stringify(l);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+c),console.table(l)}else if(1==E.TASIMA){l={FROM_STOCK_ID:E.STOCK_ID,FROM_LOT_NO:E.LotNo,FROM_AMOUNT:E.Agirlik,FROM_WRK_ROW_ID:E.PBS_RELATION_ID,TO_DEPARTMENT_ID:E.SEPET_DEPARTMAN_ID,TO_LOCATION_ID:E.SEPET_LOCATION_ID,FROM_DEPARTMENT_ID:E.STOCK_DEPARTMENT_ID,FROM_LOCATION_ID:E.STOCK_LOCATION_ID,TO_WRK_ROW_ID:i.WRK_ROW_ID[0]},c=JSON.stringify(l);$.get("/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=14&data="+c),console.table(l)}if(1!=E.SATIRDA){var D=SepeteEkle(E.SEPET_ID,"",E.PRODUCT_ID,E.Agirlik,1);OkumaEkle(E.Agirlik,1,E.LotNo,D),SatirEkle(E.PRODUCT_ID,E.PRODUCT_NAME,E.Agirlik)}else SatirGuncelle(E.PRODUCT_ID,E.Agirlik,E.LotNo);console.table(E);var m=document.getElementById("myAudio");m.play();var N=parseFloat(document.getElementById("AdS").innerText);N+=parseFloat(E.Agirlik),document.getElementById("AdS").innerText=N;var C=parseFloat(document.getElementById("AdK").innerText);C+=1,document.getElementById("AdK").innerText=C,$("#LastRead").text(E.LotNo+" - "+E.PRODUCT_NAME+" - "+E.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-success")}else{u="SELECT * FROM ( SELECT SUM(SR.STOCK_IN-SR.STOCK_OUT) AS SSSR,SR.PRODUCT_ID,SR.STOCK_ID,S.PRODUCT_NAME,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT FROM w3Toruntex_2023_1.STOCKS_ROW AS SR";u+=" INNER JOIN w3Toruntex.STOCKS_LOCATION AS SL ON SL.LOCATION_ID=SR.STORE_LOCATION AND SL.DEPARTMENT_ID=SR.STORE  INNER JOIN w3Toruntex_1.STOCKS AS S ON S.STOCK_ID=SR.STOCK_ID WHERE LOT_NO='"+S+"' GROUP BY SR.PRODUCT_ID,SR.STORE,SR.STORE_LOCATION ,SR.PBS_RELATION_ID,SL.COMMENT,SR.STOCK_ID,S.PRODUCT_NAME ) AS TTTS WHERE SSSR<>0";s=wrk_query(u,"dsn2");alert("Bu Lot Numarası Daha Önce Okutulmuş"),$("#LastRead").text(E.LotNo+" - "+s.PRODUCT_NAME[0]+" - "+E.Agirlik+"Kg."),document.getElementById("LastRead").setAttribute("class","text-danger")}$("#BARKOD").val(""),$("#BARKOD").focus()}}function OkumaEkle(e,t,r,a){var n="INSERT INTO SEVKIYAT_SEPET_ROW_READ_PBS (SEPET_ROW_ID,LOT_NO,AMOUNT,AMOUNT2) VALUES ("+a+",'"+r+"',"+e+","+t+")",_=GetAjaxQuery(n,"dsn3");return console.log(_),_.RECORDCOUNT>0&&_.RESULT.GENERATEDKEY}function SepeteEkle(e,t,r,a,n){var _="INSERT INTO  w3Toruntex_1.SEVKIYAT_SEPET_ROW_PBS (SEPET_ID,WRK_ROW_ID,PRODUCT_ID,AMOUNT,AMOUNT2) VALUES ("+e+",'"+t+"',"+r+","+a+",1) ",T=GetAjaxQuery(_,"dsn3");return T.RECORDCOUNT>0&&T.RESULT.GENERATEDKEY}function SatirEkle(e,t,r,a){var n=document.createElement("tr");n.setAttribute("class","bg-danger"),n.setAttribute("data-fromSiparis",0);var _=document.createElement("td");_.innerText=r+"/0",_.setAttribute("id","AMOUNT_"+e),n.appendChild(_);_=document.createElement("td");_.setAttribute("id","AMOUNT2_"+e),_.innerText="1/0",n.appendChild(_);_=document.createElement("td");_.setAttribute("id","PRODUCT_NAME_"+e),_.innerText=t,n.appendChild(_),n.setAttribute("data-product_id",e),n.setAttribute("data-SEPET_ROW_ID",a),document.getElementById("Sepetim").appendChild(n)}function SatirGuncelle(e,t,r){var a=document.getElementById("AMOUNT_"+e).innerText,n=list_getat(a,2,"/").trim(),_=list_getat(a,1,"/").trim(),T=parseFloat(_),O=document.getElementById("AMOUNT2_"+e).innerText,S=list_getat(O,2,"/").trim(),o=list_getat(O,1,"/").trim(),E=parseFloat(o),R=document.getElementByProductId(e).getAttribute("data-SEPET_ROW_ID"),u=(T+parseFloat(t)).toString()+"/"+n;document.getElementById("AMOUNT_"+e).innerText=u;var s=(E+1).toString()+"/"+S;document.getElementById("AMOUNT2_"+e).innerText=s;O=document.getElementById("AMOUNT2_"+e).innerText,S=list_getat(O,2,"/").trim(),o=list_getat(O,1,"/").trim(),E=parseFloat(o);var A=parseFloat(S),I=parseInt(document.getElementById("ROW_"+e).getAttribute("data-fromSiparis"));1==I?E>A?document.getElementById("ROW_"+e).setAttribute("class","bg-primary"):E==A&&document.getElementById("ROW_"+e).setAttribute("class","bg-success"):document.getElementById("ROW_"+e).setAttribute("class","bg-danger"),OkumaEkle(t,1,r,R)}function GetAjaxQuery(str_query,data_source,maxrows){var CompanyInfo=new Object,url="/index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=query_executer&isAjax=1",myAjaxConnector=GetAjaxConnector();if(myAjaxConnector&&(data="str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows,myAjaxConnector.open("post",url+"&xmlhttp=1",!1),myAjaxConnector.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),myAjaxConnector.setRequestHeader("pragma","nocache"),myAjaxConnector.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),myAjaxConnector.setRequestHeader("X-Requested-With","XMLHttpRequest"),myAjaxConnector.send(data),4==myAjaxConnector.readyState&&200==myAjaxConnector.status))try{CompanyInfo=eval(myAjaxConnector.responseText.replace(/\u200B/g,""))[0]}catch(e){CompanyInfo=!1}return CompanyInfo}function SevkiyatKapa(e,t){var r="UPDATE w3Toruntex_1.SEVKIYAT_SEPET_PBS set IS_CLOSED=1 ^ISNULL(IS_CLOSED,0) WHERE SEPET_ID="+t,a=GetAjaxQuery(r,"dsn3");console.log(a),"1"==e.getAttribute("data-status")?(e.setAttribute("data-status","0"),e.setAttribute("class","form-control btn btn-warning"),e.innerText="Sevkiyat Açık",document.getElementById("BARKOD").removeAttribute("disabled"),$("#BARKOD").focus()):(e.setAttribute("data-status","1"),e.setAttribute("class","form-control btn btn-danger"),e.innerText="Sevkiyat Kilitli",document.getElementById("BARKOD").setAttribute("disabled","true"))}function wrk_query(str_query,data_source,maxrows){function callpage(url){if(req=!1,window.XMLHttpRequest)try{req=new XMLHttpRequest}catch(e){req=!1}else if(window.ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){req=!1}}if(req){function return_function_(){if(4==req.readyState&&200==req.status)try{eval(req.responseText.replace(/\u200B/g,"")),new_query=get_js_query}catch(e){new_query=!1}}req.open("post",url+"&xmlhttp=1",!1),req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),req.setRequestHeader("pragma","nocache"),-1==encodeURI(str_query).indexOf("+")?req.send("str_sql="+encodeURI(str_query)+"&data_source="+data_source+"&maxrows="+maxrows):req.send("str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows),return_function_()}}var new_query=new Object,req;return data_source||(data_source="dsn"),maxrows||(maxrows=0),callpage("/index.cfm?fuseaction=objects2.emptypopup_get_js_query&isAjax=1"),new_query}function SendFormData(e,t){var r=document.createElement("form");r.target="Map",r.method="POST",r.action=e;var a=document.createElement("input");a.type="hidden",a.name="data",a.value=JSON.stringify(t),r.appendChild(a),document.body.appendChild(r),map=window.open(e,"Map","status=0,title=0,height=600,width=800,scrollbars=1"),map?r.submit():alert("You must allow popups for this map to work.")}function EksiislemYap(e,t){if(13==t.keyCode){var r=e.value;r=ReplaceAll(r,"||","|");list_getat(r,1,"|");var a=list_getat(r,2,"|"),n=(list_getat(r,3,"|"),document.getElementById("SEPET_ID").value),_=wrk_query("SELECT SRR.LOT_NO,SRR.SEPET_ROW_ID,SRR.AMOUNT,SSR.PRODUCT_ID,S.PRODUCT_NAME FROM SEVKIYAT_SEPET_ROW_READ_PBS AS SRR INNER JOIN SEVKIYAT_SEPET_ROW_PBS AS  SSR ON SSR.SEPET_ROW_ID=SRR.SEPET_ROW_ID INNER JOIN STOCKS AS S ON S.PRODUCT_ID=SSR.PRODUCT_ID  WHERE SRR.LOT_NO='"+a+"' AND SSR.SEPET_ID="+n,"DSN3");if(_.recordcount>0){var T="INSERT INTO w3Toruntex_1.SEVKIYAT_SEPET_CIKAN (LOT_NO,SEPET_ROW_ID,AMOUNT,SEPET_ID,PRODUCT_ID,RECORD_EMP,RECORD_DATE) VALUES ('"+a+"',"+_.SEPET_ROW_ID[0]+","+_.AMOUNT[0]+","+n+","+_.PRODUCT_ID[0]+","+UserId+",GETDATE())",O="DELETE FROM SEVKIYAT_SEPET_ROW_READ_PBS WHERE LOT_NO='"+a+"'";GetAjaxQuery(T,"DSN3"),GetAjaxQuery(O,"DSN3"),window.location.reload()}else alert(a+" Lot Numaralı Ürün Bulunamadı")}}$(document).ready(function(){var e=document.getElementsByTagName("link");for(let a=0;a<e.length;a++){var t=e[a],r=t.getAttribute("href");-1!=r.indexOf("gui_custom")&&t.remove()}1==SevkStatus?document.getElementById("BARKOD").setAttribute("disabled","true"):$("#BARKOD").focus(),$("#AdS").text(ToplamKg),$("#AdK").text(ToplamAdet)}),document.addEventListener("click",function(e){e.target!==qrcodeInput&&qrcodeInput.focus()}),document.getElementByProductId=function(e){var t=e.toString(),r=$("*").find("* [data-product_id='"+t+"']")[0];return r};