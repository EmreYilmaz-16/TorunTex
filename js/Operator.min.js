var $select=null,$sipSelect=null,MainOrderRowID=0,CurrentStation=null,ActiveStockId=0;$(document).ready((function(){document.getElementById("wrk_main_layout").setAttribute("class","container-fluid"),$sipSelect=$("#select_1").selectize({valueField:"PRODUCT_ID",labelField:"PRODUCT_NAME",searchField:"PRODUCT_NAME",onChange:eventHandler_1("onChange")}),$select=$("#select_2").selectize({valueField:"ORDER_ROW_ID",labelField:"ORDER_NUMBER",searchField:"ORDER_NUMBER",onChange:eventHandler_2("onChange")}),document.body.setAttribute("style","overflow-y: hidden;");var btn=document.createElement("button");if(null!=localStorage.getItem("ACTIVE_STATION")){var Obj=JSON.parse(localStorage.getItem("ACTIVE_STATION"));CurrentStation=Obj.STATION,$("#Location").text(Obj.FULL_STATION),getProducts(CurrentStation),getProductionInfo(Obj.DEPARTMENT_ID,Obj.LOCATION_ID),btn.setAttribute("class","btn btn-lg btn-outline-danger"),btn.innerText="Çıkış Yap",btn.setAttribute("onclick","LogOut()")}else btn.setAttribute("class","btn btn-lg btn-outline-primary"),btn.innerText="Kullanıcı Girişi",btn.setAttribute("onclick","OpenLogIn()"),OpenLogIn();document.getElementById("butonAre").appendChild(btn),$("#wrk_bug_add_div").hide(),GetDuyurus()}));var eventHandler_1=function(name){return function(){console.log(name,arguments),$("#PRODUCT_ID").val(arguments[0]),ActiveStockId=arguments[0],getOtherOrdersInfo(arguments[0]),getOrders(arguments[0])}},eventHandler_2=function(name){return function(){console.log(name,arguments),getAOrder(arguments[0])}};function OpenLogIn(){openBoxDraggable("index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=10","st00001")}function getOrders(product_id){var Obj,ST=JSON.parse(localStorage.getItem("ACTIVE_STATION")).STATION;AjaxPageLoad("index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=16&STATION="+ST+"&PRODUCT_ID="+product_id,"SiparisDataArea",1,"Yükleniyor")}function getAOrder(ORDER_ROW_ID){if(0==ORDER_ROW_ID.length&&0==MainOrderRowID){var Obj=JSON.parse(localStorage.getItem("ACTIVE_STATION"));return CurrentStation=Obj.STATION,getDepoUretim(Obj.STATION,Obj.DEPARTMENT_ID,Obj.LOCATION_ID),!1}MainOrderRowID=ORDER_ROW_ID,$("#SiparisResultAreaAs").hide(500),$.ajax({url:"/AddOns/Partner/servis/MasaServis.cfc?method=getAOrder&ORDER_ROW_ID="+ORDER_ROW_ID,success:function(retDat){try{console.log(retDat);var Obj=JSON.parse(retDat);if(console.log(Obj),-5!=Obj.ORDER_ROW_CURRENCY)alert("Üretim Durdurulmuştur"),TemizleCanim();else{$("#RenkYazi").text(Obj.PROPERTY5);var Renk1_=list_getat(Obj.PROPERTY5,1,"-"),Renk2_=list_getat(Obj.PROPERTY5,2,"-"),Renk1="",Renk2="";Renk1="BEYAZ"==Renk1_?"white":"SARI"==Renk1_?"yellow":"YEŞİL"==Renk1_?"green":"antiquewhite",Renk2="BEYAZ"==Renk2_?"white":"SARI"==Renk2_?"yellow":"YEŞİL"==Renk2_?"green":"MAVİ"==Renk2_?"blue":"antiquewhite",$("#color1").attr("style","display:block;border: solid 0.5px black;background: "+Renk1+";width: 25%;"),$("#color2").attr("style","display:block;border: solid 0.5px black;background: "+Renk2+";width: 25%;"),$("#SearchSiparisTxt").val(Obj.NICKNAME+" "+Obj.ORDER_NUMBER),$("#ActiveSiparisId").val(Obj.ORDER_ROW_ID),$("#Country").text(Obj.COUNTRY_NAME),$("#Customer").text(Obj.NICKNAME),$("#paketIcerik").val(Obj.A1),$("#paketKG").val(Obj.A2),$("#WRK_ROW_ID").val(Obj.WRK_ROW_ID),$("#SIP_DEPO").val(Obj.SIP_DEPO),$("#OrderLocation").text(Obj.COMMENT),$("#AA1").text(Obj.DETAIL_INFO_EXTRA),$("#AA2").text(Obj.AA2),$("#AA3").text(Obj.AA3),$("#AA4").text(Obj.SA_PRODUCTION_NOTE),$("#sipres").html(""),$("#Complate").text(wrk_round(Obj.TAMAMLANMA)+" %");for(let i=0;i<Obj.ALL_ROWS.length;i++){var OO=Obj.ALL_ROWS[i],tr=document.createElement("tr"),td,td,td;(td=document.createElement("td")).innerText=OO.PRODUCT_NAME,tr.appendChild(td),(td=document.createElement("td")).innerText=commaSplit(OO.QUANTITY),tr.appendChild(td),(td=document.createElement("td")).innerText=commaSplit(OO.R_AMOUNT),tr.appendChild(td),document.getElementById("sipres").appendChild(tr)}}}catch{TemizleCanim()}}})}function getProductionCount(){if(null!=localStorage.getItem("ACTIVE_STATION")){var Obj=JSON.parse(localStorage.getItem("ACTIVE_STATION")),Qstr,r=wrk_query("SELECT COUNT(*) as FF FROM STOCK_FIS AS SF where DEPARTMENT_IN="+Obj.DEPARTMENT_ID+" AND LOCATION_IN="+Obj.LOCATION_ID+" AND DAY(FIS_DATE)=DAY(GETDATE()) AND MONTH(FIS_DATE)=MONTH(FIS_DATE)","dsn2");$("#uretimCount").text(r.FF[0])}}function TemizleCanim(){$("#RenkYazi").text(""),$("#color1").attr("style","display:block;border: solid 0.5px black;background:none ;width: 25%;"),$("#color2").attr("style","display:block;border: solid 0.5px black;background:none;width: 25%;"),$("#Country").text(""),$("#OrderLocation").text(""),$("#Customer").text(""),$("#paketIcerik").val(""),$("#paketKG").val(""),$("#WRK_ROW_ID").val(""),$("#SIP_DEPO").val(""),$("#sipres").html(""),$("#Complate").text(""),$("#LotNo").val(""),$("#AA1").text(""),$("#AA2").text(""),$("#AA3").text(""),$("#AA4").text("")}function Yaz(sayi){sayi>0?"0"==TxResult.value&&-4!=sayi?TxResult.value=sayi:TxResult.value+=sayi:sayi<0?(-1==sayi&&(TxResult.value=TxResult.value.substr(0,TxResult.value.length-1)),-2==sayi&&(TxResult.value="0"),-3==sayi&&(TxResult.value=""),-4==sayi&&(TxResult.value+=","),-5==sayi&&(TxResult.value+="",$("#paketKG").val(TxResult.value))):"0"==sayi&&(TxResult.value+=sayi)}var str="",AktifSayfa=1;function GetDuyurus(op,el){}function SonrakiSayfa(){AktifSayfa++}function setSelAll(el){el.select()}function Yazdir(){var AMOUNT=document.getElementById("paketKG").value,AMOUNT22=document.getElementById("TxResult").value,SIP_DEPO=document.getElementById("SIP_DEPO").value,Objecim=JSON.parse(localStorage.ACTIVE_STATION),LOT_NO=LotVer(Objecim.STATION),WRK_ROW_ID=document.getElementById("WRK_ROW_ID").value,PRODUCT_ID=document.getElementById("PRODUCT_ID").value,Obj=JSON.parse(localStorage.getItem("ACTIVE_STATION")),Depo=Obj.DEPARTMENT_ID+"-"+Obj.LOCATION_ID,DEPARTMENT_ID=Obj.DEPARTMENT_ID,LOCATION_ID=Obj.LOCATION_ID;if(0==AMOUNT.length)return alert("Onaylayınız"),!1;$.ajax({url:"/AddOns/Partner/Servis/MasaServis.cfc?method=SaveBelge&AMOUNT="+AMOUNT+"&WRK_ROW_ID="+WRK_ROW_ID+"&LOT_NUMARASI="+LOT_NO+"&DEPO="+Depo+"&SIP_DEPO="+SIP_DEPO+"&PRODUCT_ID="+PRODUCT_ID,success:function(returnData){var Obj=JSON.parse(returnData);if(console.log(Obj),3==Obj.STATUS_CODE||2==Obj.STATUS_CODE)return alert(Obj.MESSAGE),!1;if(0==MainOrderRowID){var ssid=list_getat(SIP_DEPO,1,"-"),ssLid=list_getat(SIP_DEPO,2,"-");getDepoUretim(Objecim.STATION,ssid,ssLid)}else getAOrder(MainOrderRowID);getOtherOrdersInfo(ActiveStockId),getProductionInfo(DEPARTMENT_ID,LOCATION_ID),getProductionCount(),console.log(Obj);var GetIp=wrk_query("SELECT * FROM STATION_PRINTER_RELATION_PBS WHERE STORE_ID="+DEPARTMENT_ID+" AND LOCATION_ID="+LOCATION_ID);if(0==GetIp.recordcount)alert("Bu İstasyon İçin Yazıcı Tanımlanmamıştır Belge Kayıt Edildi Ancak Etiket Üretilmeyecektir !");else{var IP_Add=GetIp.IP_ADDRESS[0];YazdirabilirsenYazdir(Obj.COMMENT,Obj.ORDER_NUMBER,Obj.PRODUCT_CODE_2,Obj.PRODUCT_DETAIL,Obj.LOT_NO,Obj.AMOUNT,Obj.PRODUCT_NAME,IP_Add)}}})}function YazdirabilirsenYazdir(warehouse,order_no,product_no,product_note,serial_no,weight,product_name,IIIP){console.log(arguments);var ip_addr=IIIP,qr_code=product_no+"|"+serial_no+"||"+weight,zpl="^XA^XFE:etiket2.ZPL^FS^CI28^FN1^FH^FD"+warehouse+"^FS^CI27^CI28^FN2^FH^FD"+order_no+"^FS^CI27^CI28^FN3^FH^FD"+product_no+"^FS^CI27^CI28^FN4^FH^FD"+product_note+"^FS^CI27^CI28^FN5^FH^FD"+serial_no+"^FS^CI27^CI28^FN6^FH^FD"+weight+"^FS^CI27^CI28^FN7^FH^FD"+qr_code+"^FS^CI27^CI28^FN8^FH^FD"+product_name+"^FS^CI27^PQ1,0,1^XZ",url="http://"+ip_addr+"/pstprnt",method="POST",async=!0,request=new XMLHttpRequest;request.onload=function(){var status=request.status,data=request.responseText;output.innerHTML="Status: "+status+"<br>"+data},request.open(method,url,async),request.setRequestHeader("Content-Length",zpl.length),request.send(zpl)}function setStation(DEPARTMENT_ID,LOCATION_ID,STATION,FULL_STATION){var StationObject={DEPARTMENT_ID:DEPARTMENT_ID,LOCATION_ID:LOCATION_ID,STATION:STATION,FULL_STATION:FULL_STATION};localStorage.setItem("ACTIVE_STATION",JSON.stringify(StationObject)),$("#butonAre").html("");var btn=document.createElement("button");btn.setAttribute("class","btn btn-lg btn-outline-danger"),btn.innerText="Çıkış Yap",btn.setAttribute("onclick","LogOut()"),document.getElementById("butonAre").appendChild(btn),$("#Location").text(FULL_STATION),CurrentStation=StationObject.STATION,getProducts(STATION),getProductionInfo(DEPARTMENT_ID,LOCATION_ID),closeBoxDraggable("st00001")}function getProductionInfo(DEPARTMENT_ID,LOCATION_ID){AjaxPageLoad("index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=11&DEPARTMENT_ID="+DEPARTMENT_ID+"&LOCATION_ID="+LOCATION_ID,"ProductionData",1,"Yükleniyor")}function LogOut(){localStorage.removeItem("ACTIVE_STATION"),localStorage.removeItem("ACTIVE_USER"),window.location.reload()}function getOtherOrdersInfo(STOCK_ID){AjaxPageLoad("index.cfm?fuseaction=settings.emptypopup_partner_test_page&sayfa=12&STOCK_ID="+STOCK_ID,"DigerSiparis",1,"Yükleniyor")}function getProducts(STATION){var qstr="SELECT DISTINCT * FROM (";qstr+=" SELECT PRODUCT_NAME,STOCKS.PRODUCT_ID,STOCK_ID,PRODUCT_DETAIL FROM w3Toruntex_1.STOCKS LEFT JOIN w3Toruntex_1.PRODUCT_INFO_PLUS ON PRODUCT_INFO_PLUS.PRODUCT_ID=STOCKS.PRODUCT_ID ",qstr+=" WHERE PRODUCT_CATID NOT IN (26) AND PROPERTY1 LIKE '%"+STATION+"%'  UNION ALL   SELECT S.PRODUCT_NAME,S.PRODUCT_ID,S.STOCK_ID,S.PRODUCT_DETAIL FROM w3Toruntex_1.ORDER_ROW ";var q=wrk_query(qstr+=" INNER JOIN w3Toruntex_1.STOCKS AS S ON S.STOCK_ID =ORDER_ROW.STOCK_ID  WHERE UNIT2 LIKE '%"+STATION+"%' AND ORDER_ROW_CURRENCY IN (-5) )  AS T","dsn3"),Control=$sipSelect[0].selectize;Control.clearOptions();for(let index=0;index<q.PRODUCT_NAME.length;index++)Control.addOption({PRODUCT_NAME:q.PRODUCT_NAME[index],PRODUCT_ID:q.PRODUCT_ID[index],STOCK_ID:q.STOCK_ID[index],PRODUCT_DETAIL:q.PRODUCT_DETAIL[index]});getProductionCount()}function LotVer(STATION){var d=new Date,Sdate=d.toLocaleString(),Sda=list_getat(Sdate,1," "),ReturnValue="",Qstr=wrk_query("SELECT * FROM  PBS_LOT_NUMBER","dsn3");console.log(Qstr);var Lot=Qstr.LOT_NO[0],SifirSay="";1==Lot.length?SifirSay="00000":2==Lot.length?SifirSay="0000":3==Lot.length?SifirSay="000":4==Lot.length?SifirSay="00":5==Lot.length&&(SifirSay="0");var KLB="1",SCK="2",GRB="3";ReturnValue+=eval(STATION);var tsss=Math.floor(1100*Math.random())+1e3;return ReturnValue+=tsss.toString(),ReturnValue+=SifirSay,ReturnValue+=Lot,$.post("/AddOns/Partner/Servis/MasaServis.cfc?method=UpLot"),ReturnValue}function getDepoUretim(GENEL_DEPO,DEPARTMENT_ID,LOCATION_ID){MainOrderRowID=0,$("#SiparisResultAreaAs").hide(500),$("#RenkYazi").text(""),$("#color1").attr("style","display:block;border: solid 0.5px black;background:none ;width: 25%;"),$("#color2").attr("style","display:block;border: solid 0.5px black;background:none;width: 25%;"),$("#Country").text(""),$("#OrderLocation").text(GENEL_DEPO),$("#Customer").text(""),$("#paketIcerik").val("");var productData=wrk_query("SELECT PROPERTY1,PROPERTY2,PROPERTY3 FROM PRODUCT_INFO_PLUS WHERE PRODUCT_ID=6","DSN3");0==productData.recordcount?$("#paketKG").val(""):$("#paketKG").val(productData.PROPERTY3[0]),$("#WRK_ROW_ID").val(""),$("#SIP_DEPO").val(DEPARTMENT_ID+"-"+LOCATION_ID),$("#sipres").html(""),$("#Complate").text(""),$("#ActiveSiparisId").val(""),$("#SearchSiparisTxt").val(GENEL_DEPO)}function wrk_query(str_query,data_source,maxrows){var new_query=new Object,req;function callpage(url){if(req=!1,window.XMLHttpRequest)try{req=new XMLHttpRequest}catch(e){req=!1}else if(window.ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){req=!1}}if(req){function return_function_(){if(4==req.readyState&&200==req.status)try{eval(req.responseText.replace(/\u200B/g,"")),new_query=get_js_query}catch(e){new_query=!1}}req.open("post",url+"&xmlhttp=1",!1),req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),req.setRequestHeader("pragma","nocache"),-1==encodeURI(str_query).indexOf("+")?req.send("str_sql="+encodeURI(str_query)+"&data_source="+data_source+"&maxrows="+maxrows):req.send("str_sql="+encodeURIComponent(str_query)+"&data_source="+data_source+"&maxrows="+maxrows),return_function_()}}return data_source||(data_source="dsn"),maxrows||(maxrows=0),callpage("/index.cfm?fuseaction=objects2.emptypopup_get_js_query&isAjax=1"),new_query}